<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tic Tac Toe!</title>
  
  <link rel="stylesheet" type="text/css" href="normalize.css">
  <link rel="stylesheet" type="text/css" href="style.css">

  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
  <script src="http://use.edgefonts.net/actor;days-one.js"></script>
  <script src="throttle.js"></script>  
  <script src="pattern.js"></script>
  
  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
<script>
var fadeInObject = {
    "display": "block",
    "-webkit-animation": "fadeIn 1s", /* Safari and Chrome */
       "-moz-animation": "fadeIn 1s", /* Firefox */
        "-ms-animation": "fadeIn 1s", /* Internet Explorer */
         "-o-animation": "fadeIn 1s", /* Opera */
            "animation": "fadeIn 1s",
    "-webkit-animation-fill-mode": "forwards", 
    "-moz-animation-fill-mode": "forwards",
    "animation-fill-mode": "forwards"
};
var fadeInPartObject = {
    "-webkit-animation": "fadeInPart 4s", /* Safari and Chrome */
       "-moz-animation": "fadeInPart 4s", /* Firefox */
        "-ms-animation": "fadeInPart 4s", /* Internet Explorer */
         "-o-animation": "fadeInPart 4s", /* Opera */
            "animation": "fadeInPart 4s",
    "-webkit-animation-fill-mode": "forwards", 
    "-moz-animation-fill-mode": "forwards",
    "animation-fill-mode": "forwards"
};
function swapTurn(turn) {
  if (turn === 'X') return 'O';
  else return 'X';
}

function stripeItUp() {
  $("body").append("<canvas id='bgCanvas'></canvas>");
  var bgCanvas = document.getElementById('bgCanvas');
  patternInit();  
}

function adjustBoard() {
  var gbWidth = $("#gameboard").width();
  $("#gameboard").css('height', gbWidth+'px');

  var cellHeight = $(".gamecell").width(),
      fontSize = cellHeight * 0.85;

  $(".gamecell").css({
    "font-size"   : fontSize+"px",
    "line-height" : cellHeight+"px"
  });
}

function checkWin(row, col) {  
  
  if (                // Check for column win
    $("#cell1-" + col).html() == $("#cell2-" + col).html() && 
    $("#cell2-" + col).html() == $("#cell3-" + col).html() &&
    $("#cell1-" + col).html().length > 0 
  ) {

    return 'column';

  } else if (         // Check for row win
    $("#cell" + row + "-1").html() == $("#cell" + row + "-2").html() && 
    $("#cell" + row + "-2").html() == $("#cell" + row + "-3").html() &&
    $("#cell" + row + "-1").html().length > 0 
  ){

    return 'row';

  } else if (         // Check top-left-to-bottom-right diagonal
    $("#cell1-1").html() == $("#cell2-2").html() && 
    $("#cell2-2").html() == $("#cell3-3").html() && 
    $("#cell1-1").html().length > 0 
  ){

    return 'tldiag';

  } else if (         // Check top-right-to-bottom-left diagonal
    $("#cell1-3").html() == $("#cell2-2").html() && 
    $("#cell2-2").html() == $("#cell3-1").html() &&
    $("#cell1-3").html().length > 0 
  ){

    return 'trdiag';

  } else {

  }

}

function gridStrike(direction, row, col) {
  var winStyle = { backgroundColor: "#789023", color: "#EDFFAD", "z-index": 35, textShadow: "1px 1px 3px #526904" },
      winStyleDiag = { color: "#EDFFAD", "z-index": 35, textShadow: "1px 1px 3px #526904", display: "block" };


  if ( direction == 'column' ) {
    $("#cell1-" + col + ", #cell2-" + col + ", #cell3-" + col).children().css(winStyle).animate({
      height: "130%",
      marginTop: "-15%",
      paddingTop: "15%"
    }, 500);
  } else if ( direction == 'row' ) {
    $("#cell" + row + "-1, #cell" + row + "-2, #cell" + row + "-3").children().css(winStyle).animate({
      width: "130%",
      marginLeft: "-15%"
    }, 500);
  } else if ( direction == 'tldiag') {
    $("#cell1-1, #cell2-2, #cell3-3").children().css(winStyleDiag);
    $("#winLineTL").slideDown(500);
  } else if ( direction == 'trdiag') {
    $("#cell1-3, #cell2-2, #cell3-1").children().css(winStyleDiag);
    $("#winLineTR").slideDown(500);
  }
}

function updateMoveList(row, col, player) {
  $("#instructions > ul").append("<li id='moveList" + row + col + "'>" + player + " marks spot [" + row + ", " + col + "].");
  $("#moveList"+row+col).slideDown(500);
}

function updateWinPage(winner, moves) {
  $("#moveCount").html(moves);
  $("#winBackground").fadeIn(500, function() {
    $("#winText").animate({
      top: "15%"
    }, 1000, function() {
      showNewGameButton();
      $("#winLetter").html(winner).css(fadeInPartObject);
    });
  });
}

function updateTiePage() {
  $("#tieBackground").fadeIn(500, function() {
    $("#tieText").animate({
      top: "15%"
    }, 1000, function() {
      showNewGameButton();
    });
    
  });
}

function showNewGameButton() {
  $(".newGameButton").css(fadeInObject);
}

function markCell(cell, mark) {
  // Put an O in that cell
  $("#"+cell).html("<span class='" + mark + "'>" + mark + "</span>").css("cursor","default");



}


$(document).ready(function() {

  var playerTurn = true,
      moveCounter = 1,
      cells = ['cell1-1', 'cell1-2', 'cell1-3', 
               'cell2-1', 'cell2-2', 'cell2-3', 
               'cell3-1', 'cell3-2', 'cell3-3' ];

  // Load background stripes
  stripeItUp();

  // Adjust CSS for game board depending on window size
  adjustBoard();

  // Bind click event to game board cells.
  $(".gamecell").click(function() {
    if ( $(this).text().length === 0 && playerTurn) {

      $("#instructions").fadeIn(200); // Show the instruction-holding UL on the first turn.

      // Get cell ID
      cellID = $(this).attr("id");
      
      // Add the X to the board
      markCell(cellID, "X");

      // Remove the associated cell from the cells array
      cells.splice(cells.indexOf($(this).attr("id")), 1);

      // Get row/column values
      var row = cellID.substr(4,1),
          col = cellID.substr(6,1);

      updateMoveList(row, col, "Human");

      // Check for win
      winCheck = checkWin(row, col);

      if ( winCheck ) {
        gridStrike(winCheck, row, col);
        updateWinPage("X", moveCounter);
        $(".gamecell").css({"cursor": "default"}).unbind("click");
      } else if ( moveCounter == 9) {
        updateTiePage();
      } else {

        moveCounter++;

        //////// COMPUTER TURN ////////////
        playerTurn = false;

        // Find a random cell for computer to occupy, and remove it from the array.
        var randIndex = Math.floor(Math.random() * cells.length);
        var chosenCell = cells[randIndex];
        cells.splice(randIndex, 1);

        setTimeout( function() {
          markCell(chosenCell, "O");
          playerTurn = true;
          // Get row/column values
          var row = chosenCell.substr(4,1),
              col = chosenCell.substr(6,1);

          updateMoveList(row, col, "Computer");

          // Check for win
          winCheck = checkWin(row, col);

          if ( winCheck ) {
            gridStrike(winCheck, row, col);
            updateWinPage("O", moveCounter);
            $(".gamecell").css({"cursor": "default"}).unbind("click");
          } else if ( moveCounter == 9) {
            updateTiePage();
          }


          moveCounter++;    

        }, 500);

      }



    }
  });



});





</script>
</head>
<body>

<div id="cp">
  <h1 id="gametitle"><span class="capT">T</span>i<span class="tl6">c</span><span class="capT">T</span>a<span class="tl6">c</span><span class="capT">T</span>oe</h1>
  <div id="instructions">
    <ul>
    </ul>
  </div>
  <div id="decorativeBar4" class="decBar"></div>
  <div id="decorativeBar3" class="decBar"></div>
  <div id="decorativeBar2" class="decBar"></div>
  <div id="decorativeBar1" class="decBar"></div>

</div><div id="game">
  <div id="gameboard">
    <span id="winLineTL"></span>
    <span id="winLineTR"></span>

    <div><div id="cell1-1" class="gamecell"></div></div>
    <div><div id="cell1-2" class="gamecell"></div></div>
    <div><div id="cell1-3" class="gamecell"></div></div>
    
    <div><div id="cell2-1" class="gamecell"></div></div>
    <div><div id="cell2-2" class="gamecell"></div></div>
    <div><div id="cell2-3" class="gamecell"></div></div>

    <div><div id="cell3-1" class="gamecell"></div></div>
    <div><div id="cell3-2" class="gamecell"></div></div>
    <div><div id="cell3-3" class="gamecell"></div></div>
  </div>

  <div id="winBackground">
    <div id="winLetter"></div>
    <div id="winText">
      <h2>Good Job.</h2>
      <h4>You're a TicTacToe master.</h4>
    </div>


  </div>

  <div id="tieBackground">
    <div id="tieText">
      <h2>You guys suck.</h2>
      <h4>Ties are lame. Play harder next time!</h4>
    </div>
  </div>

</div>

<a href="" class="newGameButton">
  - Play Again -
</a>

</body>
</html>